#!/bin/bash

cd src
make
cd ..

cd rootfs
find . | cpio -o -H newc > ../initramfs.cpio
cd ..
gzip initramfs.cpio

qemu-system-x86_64 \
  -kernel ./bzImage \
  -initrd ./initramfs.cpio.gz \
  -append "console=ttyS0 kaslr panic=-1" \
  -monitor none \
  -nographic \
  -no-reboot \
  -cpu qemu64,+smep,+smap\
  -m 256M \
  -s
